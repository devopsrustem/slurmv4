---
# playbooks/site_fixed.yml
# ================================================================================
# –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ü–û–õ–ù–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï SLURM HPC –ö–õ–ê–°–¢–ï–†–ê + –ö–û–ù–¢–ï–ô–ù–ï–†–´
# ================================================================================
# Ubuntu 24.04 + Slurm 25.05.1 + JWT + Enroot + Pyxis + Login —É–∑–µ–ª
# –†–ê–ë–û–¢–ê–ï–¢ –ò–ó –ö–û–†–û–ë–ö–ò –ë–ï–ó –ö–û–°–¢–´–õ–ï–ô!

- name: "üöÄ Slurm HPC Cluster - –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"
  hosts: localhost
  gather_facts: false
  tasks:
    - name: "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏"
      debug:
        msg: |
          ================================================================================
          üöÄ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ü–û–õ–ù–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï SLURM HPC –ö–õ–ê–°–¢–ï–†–ê
          ================================================================================
          üìã OS: Ubuntu 24.04 LTS
          üîß Slurm: 25.05.1 —Å JWT –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π + headers
          üê≥ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: Enroot + Pyxis (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ!)
          üéØ –ö–ª–∞—Å—Ç–µ—Ä: hpc-cluster
          
          üìä –£–∑–ª—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:
          üéõÔ∏è  Master:  {{ groups['slurm_master'] | join(', ') }}
          üîë Login:   {{ groups['slurm_login'] | join(', ') }}  
          üíª Compute: {{ groups['slurm_compute'] | join(', ') }}
          üìà –í—Å–µ–≥–æ:   {{ groups['slurm_cluster'] | length }} —É–∑–ª–æ–≤
          
          üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
          ‚úÖ Slurm headers –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö
          ‚úÖ Pyxis –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
          ‚úÖ –ï–¥–∏–Ω—ã–µ –ø—É—Ç–∏ –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥–∞—Ö
          ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏!
          
          ‚è±Ô∏è  –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: ~20-25 –º–∏–Ω—É—Ç
          ================================================================================

# ================================================================================
# –≠–¢–ê–ü 0: –û–ß–ò–°–¢–ö–ê –°–¢–ê–†–´–• –ü–†–û–ë–õ–ï–ú–ù–´–• –§–ê–ô–õ–û–í
# ================================================================================

- name: "üßπ –≠–¢–ê–ü 0/6: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
  hosts: slurm_cluster
  become: true
  gather_facts: false
  tasks:
    - name: "üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤"
      shell: |
        echo "=== –û–ß–ò–°–¢–ö–ê –°–¢–ê–†–´–• –§–ê–ô–õ–û–í ==="
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–ª–∞–≥–∏–Ω—ã
        rm -f /usr/local/lib/slurm/spank_pyxis.so
        rm -f /usr/local/src/pyxis/spank_pyxis.so
        rm -rf /usr/local/src/pyxis/*
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏
        rm -f /etc/slurm/plugstack.conf
        
        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º slurmd –µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω
        systemctl stop slurmd 2>/dev/null || true
        
        echo "–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã, –≥–æ—Ç–æ–≤—ã –∫ —á–∏—Å—Ç–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ"
      register: cleanup_result
      
    - name: "üßπ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—á–∏—Å—Ç–∫–∏"
      debug:
        var: cleanup_result.stdout

# ================================================================================
# –≠–¢–ê–ü 1: –ë–ê–ó–û–í–ê–Ø –ü–û–î–ì–û–¢–û–í–ö–ê –í–°–ï–• –£–ó–õ–û–í
# ================================================================================

- name: "üì¶ –≠–¢–ê–ü 1/6: –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö —É–∑–ª–æ–≤"
  hosts: slurm_cluster
  become: true
  gather_facts: true
  tasks:
    - name: "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç—Ç–∞–ø–µ"
      debug:
        msg: |
          üì¶ –≠–¢–ê–ü 1: –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
          üîß –£–∑–µ–ª: {{ inventory_hostname }}
          üìç IP: {{ ansible_default_ipv4.address | default('–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...') }}
          üíæ RAM: {{ (ansible_memtotal_mb / 1024) | round(1) }}GB
          üñ•Ô∏è  CPU: {{ ansible_processor_vcpus }}
      run_once: false

  roles:
    - common

  post_tasks:
    - name: "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–∞–ø–∞ 1"
      debug:
        msg: |
          ‚úÖ –≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à–µ–Ω –Ω–∞ {{ inventory_hostname }}
          üîë MUNGE: –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω
          üìÅ NFS: {{ '–Ω–∞—Å—Ç—Ä–æ–µ–Ω' if inventory_hostname in groups['nfs_server'] else '–ø–æ–¥–∫–ª—é—á–µ–Ω' }}
          üíæ MariaDB: {{ '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' if inventory_hostname in groups['slurm_master'] else '–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è' }}

# ================================================================================
# –≠–¢–ê–ü 2: –ö–û–ú–ü–ò–õ–Ø–¶–ò–Ø SLURM –ù–ê –ú–ê–°–¢–ï–†–ï (–° HEADERS!)
# ================================================================================

- name: "üî® –≠–¢–ê–ü 2/6: –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –∫–æ–º–ø–∏–ª—è—Ü–∏—è Slurm —Å headers"
  hosts: slurm_master
  become: true
  gather_facts: true
  tasks:
    - name: "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏"
      debug:
        msg: |
          üî® –≠–¢–ê–ü 2: –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –∫–æ–º–ø–∏–ª—è—Ü–∏—è Slurm 25.05.1
          üìç –ú–∞—Å—Ç–µ—Ä —É–∑–µ–ª: {{ inventory_hostname }}
          ‚úÖ Headers –±—É–¥—É—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω—ã –Ω–∞ –í–°–ï —É–∑–ª—ã!
          ‚ö†Ô∏è  –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∑–∞–π–º–µ—Ç ~10-15 –º–∏–Ω—É—Ç...

  roles:
    - slurm_build

  post_tasks:
    - name: "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏"
      debug:
        msg: |
          ‚úÖ Slurm —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω —Å headers!
          üì¶ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤: /opt/slurm
          üîó –°—Å—ã–ª–∫–∏ —Å–æ–∑–¥–∞–Ω—ã: /usr/bin/sinfo, /usr/sbin/slurmctld
          üì§ –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω —á–µ—Ä–µ–∑ NFS: /sw/slurm-complete
          üìÅ Headers: /opt/slurm/include/slurm/spank.h (–ù–ê –í–°–ï–• –£–ó–õ–ê–•!)

# ================================================================================
# –≠–¢–ê–ü 3: –ù–ê–°–¢–†–û–ô–ö–ê –ú–ê–°–¢–ï–†–ê
# ================================================================================

- name: "üéõÔ∏è –≠–¢–ê–ü 3/6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Slurm Master"
  hosts: slurm_master
  become: true
  gather_facts: true
  roles:
    - slurm_master

  post_tasks:
    - name: "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Å—Ç–µ—Ä–∞"
      shell: |
        echo "=== –°–¢–ê–¢–£–° –°–ï–†–í–ò–°–û–í ==="
        systemctl is-active slurmctld slurmdbd
        echo "=== –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ==="
        /usr/bin/scontrol ping
      register: master_check
      changed_when: false
      
    - name: "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Å—Ç–µ—Ä–∞"
      debug:
        msg: |
          ‚úÖ Slurm Master {{ inventory_hostname }} –≥–æ—Ç–æ–≤!
          {{ master_check.stdout }}

# ================================================================================
# –≠–¢–ê–ü 4: –ù–ê–°–¢–†–û–ô–ö–ê COMPUTE –£–ó–õ–û–í
# ================================================================================

- name: "üíª –≠–¢–ê–ü 4/6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Compute —É–∑–ª–æ–≤"
  hosts: slurm_compute
  become: true
  gather_facts: true
  roles:
    - slurm_compute

  post_tasks:
    - name: "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ compute —É–∑–ª–æ–≤"
      shell: |
        echo "=== –°–¢–ê–¢–£–° SLURMD ==="
        systemctl is-active slurmd
        echo "=== –í–ï–†–°–ò–Ø SLURM ==="
        /usr/bin/sinfo --version
      register: compute_check
      changed_when: false
      
    - name: "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ compute"
      debug:
        msg: |
          ‚úÖ Compute —É–∑–µ–ª {{ inventory_hostname }} –≥–æ—Ç–æ–≤!
          {{ compute_check.stdout }}

# ================================================================================
# –≠–¢–ê–ü 5: –ù–ê–°–¢–†–û–ô–ö–ê LOGIN –£–ó–õ–û–í
# ================================================================================

- name: "üîë –≠–¢–ê–ü 5/6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Login —É–∑–ª–æ–≤"
  hosts: slurm_login
  become: true
  gather_facts: true
  roles:
    - slurm_login

  post_tasks:
    - name: "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ login —É–∑–ª–æ–≤"
      shell: |
        echo "=== –ö–û–ú–ê–ù–î–´ SLURM ==="
        /usr/bin/sinfo --version
        echo "=== –î–û–°–¢–£–ü –ö –ö–õ–ê–°–¢–ï–†–£ ==="
        /usr/bin/sinfo --summarize 2>&1 || echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
      register: login_check
      changed_when: false
      
    - name: "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ login"
      debug:
        msg: |
          ‚úÖ Login —É–∑–µ–ª {{ inventory_hostname }} –≥–æ—Ç–æ–≤!
          {{ login_check.stdout }}

# ================================================================================
# –≠–¢–ê–ü 6: –£–°–¢–ê–ù–û–í–ö–ê –ö–û–ù–¢–ï–ô–ù–ï–†–û–í (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø!)
# ================================================================================

- name: "üê≥ –≠–¢–ê–ü 6/6: –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
  hosts: slurm_cluster
  become: true
  gather_facts: true
  tasks:
    - name: "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
      debug:
        msg: |
          üê≥ –≠–¢–ê–ü 6: –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Enroot + Pyxis
          üîß –£–∑–µ–ª: {{ inventory_hostname }}
          üìÅ Headers: –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø–µ—Ä–µ–¥ –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π Pyxis
          üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑ –∫–æ—Ä–æ–±–∫–∏!
      run_once: false

  roles:
    - containers

  post_tasks:
    - name: "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
      debug:
        msg: |
          ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ {{ inventory_hostname }}!
          üì¶ Enroot: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
          {% if inventory_hostname in groups['slurm_compute'] %}
          üîå Pyxis: —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ headers
          üìù plugstack.conf: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø—É—Ç—å –∫ –ø–ª–∞–≥–∏–Ω—É
          üîÑ slurmd: –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
          {% endif %}

# ================================================================================
# –≠–¢–ê–ü 7: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
# ================================================================================

- name: "‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ + –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
  hosts: slurm_master
  become: true
  gather_facts: false
  tasks:
    - name: "üß™ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞ + –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
      shell: |
        echo "================================================================================"
        echo "üß™ –§–ò–ù–ê–õ–¨–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–õ–ê–°–¢–ï–†–ê + –ö–û–ù–¢–ï–ô–ù–ï–†–û–í"
        echo "================================================================================"
        echo ""
        echo "üéõÔ∏è –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:"
        /usr/bin/scontrol ping
        echo ""
        echo "üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ:"
        /usr/bin/sinfo
        echo ""
        echo "üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–∑–ª–∞—Ö:"
        /usr/bin/sinfo -N
        echo ""
        echo "üß™ –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–π –∑–∞–¥–∞—á–∏:"
        timeout 30 /usr/bin/srun -N1 hostname
        echo ""
        echo "üê≥ –¢–ï–°–¢ –ö–û–ù–¢–ï–ô–ù–ï–†–ê (–ì–õ–ê–í–ù–´–ô!):"
        timeout 60 /usr/bin/srun --container-image=docker://hello-world 2>&1 || echo "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ—à–µ–ª"
        echo ""
        echo "üêß –¢–µ—Å—Ç Ubuntu –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
        timeout 60 /usr/bin/srun --container-image=docker://ubuntu:22.04 /bin/bash -c "uname -a && echo 'Ubuntu –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!'" 2>&1 || echo "Ubuntu —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ—à–µ–ª"
        echo ""
        echo "üìä –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á:"
        /usr/bin/squeue
        echo ""
        echo "================================================================================"
      register: full_cluster_test
      changed_when: false
      failed_when: false

- name: "‚úÖ –ü–†–û–í–ï–†–ö–ê LOGIN –£–ó–õ–û–í"
  hosts: slurm_login
  become: true
  gather_facts: false
  tasks:
    - name: "üîë –¢–µ—Å—Ç login —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"
      shell: |
        echo "üîë –¢–µ—Å—Ç login —É–∑–ª–∞ {{ inventory_hostname }}:"
        echo "  –í–µ—Ä—Å–∏—è: $(/usr/bin/sinfo --version)"
        echo "  –ö–ª–∞—Å—Ç–µ—Ä: $(/usr/bin/sinfo --summarize 2>&1 | head -1 || echo '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω')"
        echo "  –ö–æ–º–∞–Ω–¥—ã: $(ls /usr/bin/s* | grep -E '(sinfo|squeue|srun|sbatch)' | wc -l) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
      register: login_final_test
      changed_when: false

# ================================================================================
# –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ò
# ================================================================================

- name: "üìä –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢"
  hosts: localhost
  gather_facts: false
  tasks:
    - name: "üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è HPC –∫–ª–∞—Å—Ç–µ—Ä–∞"
      debug:
        msg: |
          ================================================================================
          üéâ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï SLURM HPC –ö–õ–ê–°–¢–ï–†–ê –ó–ê–í–ï–†–®–ï–ù–û!
          ================================================================================
          
          üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
          {{ hostvars[groups['slurm_master'][0]]['full_cluster_test']['stdout'] }}
          
          üîë LOGIN –£–ó–õ–´:
          {% for host in groups['slurm_login'] %}
          {{ hostvars[host]['login_final_test']['stdout'] }}
          {% endfor %}
          
          ================================================================================
          {% if hostvars[groups['slurm_master'][0]]['full_cluster_test']['stdout'] is search('Hello from Docker') %}
          üéâ –ö–û–ù–¢–ï–ô–ù–ï–†–´ –†–ê–ë–û–¢–ê–Æ–¢! –ü–û–õ–ù–´–ô –£–°–ü–ï–•! üéâ
          {% else %}
          ‚ö†Ô∏è  –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
          {% endif %}
          ================================================================================
          ‚úÖ –ö–õ–ê–°–¢–ï–† –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!
          ================================================================================
          
          üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è:
          {% for host in groups['slurm_login'] %}
          ssh username@{{ host }}
          {% endfor %}
          
          üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
          - sinfo     - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ
          - squeue    - –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á  
          - sbatch    - –ø–∞–∫–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
          - srun      - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
          - scancel   - –æ—Ç–º–µ–Ω–∞ –∑–∞–¥–∞—á
          
          üê≥ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
          - srun --container-image=docker://ubuntu:22.04 hostname
          - srun --pty --container-image=docker://ubuntu:22.04 /bin/bash
          - sbatch --container-image=nvcr.io/nvidia/pytorch:23.12-py3 script.py
          
          üìÅ –û–±—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
          - /home     - –¥–æ–º–∞—à–Ω–∏–µ –ø–∞–ø–∫–∏ (NFS)
          - /sw       - –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (NFS)
          - /scratch  - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
          - /projects - –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          
          üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:
          - Master:   {{ groups['slurm_master'][0] }}
          - Login:    {{ groups['slurm_login'] | join(', ') }}
          - Compute:  {{ groups['slurm_compute'] | join(', ') }}
          
          ================================================================================
          üöÄ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ü–†–û–ï–ö–¢ –†–ê–ë–û–¢–ê–ï–¢ –ò–ó –ö–û–†–û–ë–ö–ò!
          ================================================================================