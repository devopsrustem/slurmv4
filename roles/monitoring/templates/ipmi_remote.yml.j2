# Configuration file for ipmi_exporter
# Generated by Ansible monitoring role

modules:
        default:
                user: "{{ ipmi_default_user | default('monor') }}"
                pass: "{{ ipmi_default_password | default('vxCPJ1V') }}"
                driver: "{{ ipmi_default_driver | default('LAN_2_0') }}"
                privilege: "{{ ipmi_default_privilege | default('user') }}"
                timeout: {{ ipmi_default_timeout | default('10000') }}
                collectors:
{% for collector in ipmi_default_collectors | default(['bmc', 'ipmi', 'chassis']) %}
                - {{ collector }}
{% endfor %}
{% if ipmi_exclude_sensor_ids is defined and ipmi_exclude_sensor_ids | length > 0 %}
                exclude_sensor_ids:
{% for sensor_id in ipmi_exclude_sensor_ids %}
                - {{ sensor_id }}
{% endfor %}
{% endif %}

{% if ipmi_dcmi_enabled | default(false) %}
        dcmi:
                user: "{{ ipmi_dcmi_user | default('monor') }}"
                pass: "{{ ipmi_dcmi_password | default('vxCqJ1V') }}"
                privilege: "{{ ipmi_dcmi_privilege | default('admin') }}"
                driver: "{{ ipmi_dcmi_driver | default('LAN_2_0') }}"
                collectors:
                - dcmi
{% endif %}

{% if ipmi_custom_modules is defined %}
{% for module_name, module_config in ipmi_custom_modules.items() %}
        {{ module_name }}:
                user: "{{ module_config.user }}"
                pass: "{{ module_config.password }}"
                privilege: "{{ module_config.privilege | default('user') }}"
                driver: "{{ module_config.driver | default('LAN_2_0') }}"
{% if module_config.collectors is defined %}
                collectors:
{% for collector in module_config.collectors %}
                - {{ collector }}
{% endfor %}
{% endif %}
{% if module_config.workaround_flags is defined %}
                workaround_flags:
{% for flag in module_config.workaround_flags %}
                - {{ flag }}
{% endfor %}
{% endif %}
{% if module_config.custom_args is defined %}
                custom_args:
{% for collector, args in module_config.custom_args.items() %}
                        {{ collector }}:
{% for arg in args %}
                        - "{{ arg }}"
{% endfor %}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}