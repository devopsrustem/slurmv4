# roles/slurm_master/templates/slurmdbd.conf.j2
#
# Slurm Database Daemon configuration file
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Cluster: {{ slurm_cluster_name }}
#

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================

# Authentication info
AuthType=auth/munge
AuthInfo=/var/run/munge/munge.socket.2

# User/Group
SlurmUser={{ slurm_user }}

# =============================================================================
# DATABASE CONNECTION
# =============================================================================

# Database connection
DbdHost={{ slurm_db_host }}
DbdPort=6819

# Storage connection  
StorageType=accounting_storage/mysql
StorageHost=localhost
StoragePort={{ slurm_db_port }}
StorageUser={{ slurm_db_user }}
StoragePass={{ slurm_db_password }}
StorageLoc={{ slurm_db_name }}

# =============================================================================
# LOGGING
# =============================================================================

# Logging
LogFile={{ slurm_log_dir }}/slurmdbd.log
DebugLevel={{ slurm_debug_level }}
PidFile=/var/run/slurmdbd.pid

# Log rotation
LogTimeFormat=iso8601_ms

# =============================================================================
# ARCHIVING
# =============================================================================

# Archive settings
ArchiveJobs=yes
ArchiveResvs=yes  
ArchiveSteps=yes
ArchiveSuspend=no
ArchiveTXN=no
ArchiveUsage=no

# =============================================================================
# PURGING
# =============================================================================

# Purge job records older than 12 months
PurgeJobAfter=12months
PurgeResvAfter=1month
PurgeStepAfter=1month
PurgeSuspendAfter=1month
PurgeTXNAfter=1month
PurgeUsageAfter=24months

# =============================================================================
# COMMUNICATION
# =============================================================================

# TCP settings
TCPTimeout=10
MessageTimeout=10

# =============================================================================
# FOOTER
# =============================================================================
#
# SlurmDBD configuration for {{ slurm_cluster_name }}
# Database: {{ slurm_db_name }} on {{ slurm_db_host }}:{{ slurm_db_port }}
# Generated: {{ ansible_date_time.iso8601 }}
#