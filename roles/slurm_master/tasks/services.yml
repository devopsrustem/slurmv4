# roles/slurm_master/tasks/services.yml
---
# =============================================================================
# SYSTEMD SERVICES (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
# =============================================================================

- name: "[SERVICES] –°–æ–∑–¥–∞–Ω–∏–µ systemd unit –¥–ª—è slurmctld"
  template:
    src: slurmctld.service.j2
    dest: /etc/systemd/system/slurmctld.service
    owner: root
    group: root
    mode: '0644'
  notify: restart slurmctld
  tags: services

- name: "[SERVICES] –°–æ–∑–¥–∞–Ω–∏–µ systemd unit –¥–ª—è slurmdbd"
  template:
    src: slurmdbd.service.j2
    dest: /etc/systemd/system/slurmdbd.service
    owner: root
    group: root
    mode: '0644'
  when: slurm_db_enabled | default(true)
  notify: restart slurmdbd
  tags: services

- name: "[SERVICES] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ systemd daemon"
  systemd:
    daemon_reload: yes
  tags: services

- name: "[SERVICES] –ó–∞–ø—É—Å–∫ slurmdbd (—Å–Ω–∞—á–∞–ª–∞ –±–∞–∑–∞)"
  systemd:
    name: slurmdbd
    enabled: yes
    state: started
  when: slurm_db_enabled | default(true)
  tags: services

- name: "[SERVICES] –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ slurmdbd"
  pause:
    seconds: 3
  when: slurm_db_enabled | default(true)
  tags: services

- name: "[SERVICES] –ó–∞–ø—É—Å–∫ slurmctld (–ø–æ—Å–ª–µ –±–∞–∑—ã)"
  systemd:
    name: slurmctld
    enabled: yes
    state: started
  tags: services

- name: "[SERVICES] –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã"
  debug:
    msg: |
      üéõÔ∏è Slurm —Å–µ—Ä–≤–∏—Å—ã:
      ‚úÖ slurmdbd –∑–∞–ø—É—â–µ–Ω
      ‚úÖ slurmctld –∑–∞–ø—É—â–µ–Ω
      üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: systemctl status slurmctld slurmdbd
  tags: services