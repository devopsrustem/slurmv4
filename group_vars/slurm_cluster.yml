# group_vars/slurm_cluster.yml 444
---
# Переменные для всего Slurm кластера (БЕЗ ХАРДКОДА)

# =============================================================================
# КЛАСТЕР НАСТРОЙКИ  
# =============================================================================

slurm_cluster_name: "hpc-cluster"
timezone: "Europe/Moscow"
slurm_force_rebuild: false

# =============================================================================
# NFS НАСТРОЙКИ (АВТООПРЕДЕЛЕНИЕ)
# =============================================================================

# NFS сервер автоматически определится как первый в группе slurm_master
# nfs_server: "{{ groups['slurm_master'][0] }}"

# NFS экспорты автоматически создадутся для всех узлов в nfs_client группе
nfs_export_options: "rw,sync,no_root_squash"
nfs_mount_options: "defaults,_netdev"

# =============================================================================
# SLURM НАСТРОЙКИ
# =============================================================================

slurm_user: "slurm"
slurm_group: "slurm"
slurm_debug_level: "3"

# =============================================================================
# NVIDIA ENROOT + PYXIS КОНФИГУРАЦИЯ (DEEPOPS ПОДХОД)
# =============================================================================

# Версия enroot (роль ставит 3.2.0 по умолчанию)
enroot_version: "3.2.0"

# Установка Pyxis
slurm_install_pyxis: true
slurm_pyxis_version: "0.20.0"

# Конфигурация enroot.conf (DeepOps пути)
enroot_config: |
  ENROOT_CONFIG_PATH ${HOME}/.config/enroot
  ENROOT_SQUASH_OPTIONS -noI -noD -noF -noX -no-duplicates
  ENROOT_MOUNT_HOME n
  ENROOT_RESTRICT_DEV y
  ENROOT_ROOTFS_WRITABLE y
  ENROOT_RUNTIME_PATH /run/enroot/user-$(id -u)
  ENROOT_CACHE_PATH /var/lib/enroot-cache/group-$(id -g)
  ENROOT_DATA_PATH /tmp/enroot-data/user-$(id -u)

# Дополнительные environ файлы (если нужны)
enroot_environ_config_files: []

# Hook файлы (если нужны)  
enroot_hook_config_files: []

# Mount файлы (если нужны)
enroot_mount_config_files: []

# =============================================================================
# ПРИМЕР ПЕРЕОПРЕДЕЛЕНИЯ ЧЕРЕЗ INVENTORY
# =============================================================================

# Если нужно переопределить для конкретного окружения,
# можно сделать так в inventory:
#
# [slurm_cluster:vars]
# timezone=UTC
# slurm_cluster_name=prod-hpc-cluster
# nfs_export_options=rw,sync,no_root_squash,no_subtree_check
#
# Или создать отдельные group_vars для разных окружений:
# group_vars/prod/slurm_cluster.yml
# group_vars/dev/slurm_cluster.yml
# group_vars/test/slurm_cluster.yml